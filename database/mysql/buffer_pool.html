<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>buffer_pool | 思考学习仓库</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="思考学习仓库沉淀">
    
    <link rel="preload" href="/back-end/assets/css/0.styles.e1ce56f9.css" as="style"><link rel="preload" href="/back-end/assets/js/app.c4a64f45.js" as="script"><link rel="preload" href="/back-end/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/back-end/assets/js/60.0a6cae4e.js" as="script">
    <link rel="stylesheet" href="/back-end/assets/css/0.styles.e1ce56f9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/back-end/" class="home-link router-link-active"><!----> <span class="site-name">思考学习仓库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/back-end/" class="nav-link">
  思考学习仓库
</a></div><div class="nav-item"><a href="/back-end/back-end-basic/" class="nav-link">
  java基础
</a></div><div class="nav-item"><a href="/back-end/middleware/" class="nav-link">
  中间件
</a></div><div class="nav-item"><a href="/back-end/spring/" class="nav-link">
  Spring框架
</a></div><div class="nav-item"><a href="/back-end/microservices/" class="nav-link">
  微服务框架
</a></div><div class="nav-item"><a href="/back-end/database/" class="nav-link router-link-active">
  数据库篇章
</a></div> <a href="https://github.com/think-studio/back-end" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/back-end/" class="nav-link">
  思考学习仓库
</a></div><div class="nav-item"><a href="/back-end/back-end-basic/" class="nav-link">
  java基础
</a></div><div class="nav-item"><a href="/back-end/middleware/" class="nav-link">
  中间件
</a></div><div class="nav-item"><a href="/back-end/spring/" class="nav-link">
  Spring框架
</a></div><div class="nav-item"><a href="/back-end/microservices/" class="nav-link">
  微服务框架
</a></div><div class="nav-item"><a href="/back-end/database/" class="nav-link router-link-active">
  数据库篇章
</a></div> <a href="https://github.com/think-studio/back-end" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>mysql</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/back-end/database/mysql/mysql基础.html" class="sidebar-link">mysql基础</a></li><li><a href="/back-end/database/mysql/mysql锁.html" class="sidebar-link">mysql锁</a></li><li><a href="/back-end/database/mysql/msyql索引.html" class="sidebar-link">mysql索引</a></li><li><a href="/back-end/database/mysql/mvcc和read_view.html" class="sidebar-link">mvcc和read_view</a></li><li><a href="/back-end/database/mysql/buffer_pool.html" aria-current="page" class="active sidebar-link">buffer_pool</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/back-end/database/mysql/buffer_pool.html#buffer-pool-lru-algorithm" class="sidebar-link">Buffer Pool LRU Algorithm</a></li><li class="sidebar-sub-header"><a href="/back-end/database/mysql/buffer_pool.html#buffer-pool-配置" class="sidebar-link">Buffer Pool 配置</a></li></ul></li><li><a href="/back-end/database/mysql/mysql三大日志.html" class="sidebar-link">mysql三大日志</a></li><li><a href="/back-end/database/mysql/mysql主从.html" class="sidebar-link">mysql主从</a></li><li><a href="/back-end/database/mysql/mysql执行一条sql过程.html" class="sidebar-link">mysql执行一条sql过程</a></li><li><a href="/back-end/database/oltp/oltp型数据库.html" class="sidebar-link">oltp型数据库</a></li><li><a href="/back-end/database/olap/olap分析型数据库.html" class="sidebar-link">olap分析型数据库</a></li><li><a href="/back-end/database/mpp/mpp型数据库.html" class="sidebar-link">mpp型数据库</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="buffer-pool"><a href="#buffer-pool" class="header-anchor">#</a> buffer_pool</h1> <p>缓冲池 (buffer pool) 是主内存中的一个区域,InnoDB 引擎会将访问过的表和索引数据缓存在这个区域中。缓冲池(buffer pool)允许经常使用的数据可以直接从内存中访问,这可以加快处理速度。对于专用服务器 (Dedicated servers), 通常会将高达物理内存的80%分配给缓冲池 (buffer pool)。</p> <p>为了高效率的大量读取操作,缓冲池被分成可容纳多个行的数据页。</p> <p>为了高效率的缓存管理,缓冲池被实现为一个链接列表的页面;很少使用的数据会通过变种的最近最少使用(LRU)算法从缓存中淘汰。
了解如何利用缓冲池来保持频繁访问的数据在内存中,是 MySQL 调优的一个重要方面。</p> <p>这是 BufferPool 在 InnoDB 中的位置
<img src="https://dev.mysql.com/doc/refman/8.0/en/images/innodb-architecture-8-0.png" alt=""></p> <h2 id="buffer-pool-lru-algorithm"><a href="#buffer-pool-lru-algorithm" class="header-anchor">#</a> Buffer Pool LRU Algorithm</h2> <p>buffer pool 是使用 LRU 算法变体管理一个链表。当需要为 buffer pool 添加新页面( page )时,最近最少使用的页面会被淘汰,新的页面会添加到链表的中间。这种中间插入策略把链表视为两个子链表:</p> <ul><li>在头部,包含新添加(&quot;年轻&quot;)但最近访问的页面的子链表 (sublist)</li> <li>在尾部,包含较旧但访问较少的页面的子链表</li></ul> <h3 id="bufferpool-lru-链表的中间是怎么得出的"><a href="#bufferpool-lru-链表的中间是怎么得出的" class="header-anchor">#</a> BufferPool LRU 链表的中间是怎么得出的？</h3> <p>BufferPool LRU 链表的中间，主要通过监控访问频率来判断。</p> <p>BufferPool 会记录每一个页的访问频率(通常是访问次数)。新的页面被插入时,访问频率默认为 0。</p> <p>随着页面被访问和修改,访问频率会不断增加。</p> <p>BufferPool 会定期扫描整个链表,找出访问频率处于中间水平的页面(既不是最高也不是最低),然后将新的页面插入到这个位置。</p> <h3 id="figure-15-2-buffer-pool-list"><a href="#figure-15-2-buffer-pool-list" class="header-anchor">#</a> Figure 15.2 Buffer Pool List</h3> <p><img src="https://dev.mysql.com/doc/refman/8.0/en/images/innodb-buffer-pool-list.png" alt=""></p> <p>该算法将频繁使用的页保存在 New Sublist （新子列表）中。Old Sublist （旧子列表） 包含使用频率较低的页面; 这些页可能会被<a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_eviction" target="_blank" rel="noopener noreferrer">淘汰<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)。</p> <p>默认情况下，算法运行如下:</p> <ul><li>缓存池的 3/8 用于旧子列表。</li> <li>列表的 midpoint （中点）是新子列表的尾部与旧子列表的头部相接的边界。</li> <li>当 InnoDB 将页读入缓冲池时，它最初将其插入到中点(旧子列表的头部)，一个页可以被读取，因为它是用户发起的操作(如 SQL 查询)所必需的，或者是作为 InnoDB 自动执行的 <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_read_ahead" target="_blank" rel="noopener noreferrer">read-ahead<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（预读）操作的一部分。</li> <li>访问旧子列表中的一个页面会使这个页面&quot;变年轻&quot;,将它移动到新子列表的头部。如果这个页面是因为用户发起的操作需要而读取的,那么首次访问将立即发生,这个页面就会年轻化。 如果这个页面是由于预读操作读取的,那么 first access（首次访问）可能不会立即发生,也可能在这个页面被淘汰之前都不会发生。</li> <li>当数据库运行的时候,未被访问的 buffer pool 中的页会随时间&quot;变老&quot;,通过移动到链表的尾部实现。页既在新子列表,也在旧子列表中&quot;变老&quot;,这取决于其他页面&quot;变得年轻&quot;。旧子列表中的页面还会随着新页面插入到中点位置而&quot;变老&quot;。最终,如果一个页面长时间未被使用,它最终会移动到旧子列表的末尾,并被淘汰。</li></ul> <h2 id="buffer-pool-配置"><a href="#buffer-pool-配置" class="header-anchor">#</a> Buffer Pool 配置</h2> <p>待完成</p> <p>参考链接</p> <ul><li><a href="https://dev.mysql.com/blog-archive/mysql-8-0-new-lock-free-scalable-wal-design/" target="_blank" rel="noopener noreferrer">MySQL 8.0: New Lock free, scalable WAL design<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/think-studio/back-end/edit/learn-warehouse/docs/database/mysql/buffer_pool.md" target="_blank" rel="noopener noreferrer">欢迎来到思考学习仓库,一起沉淀知识</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/back-end/database/mysql/mvcc和read_view.html" class="prev">
        mvcc和read_view
      </a></span> <span class="next"><a href="/back-end/database/mysql/mysql三大日志.html">
        mysql三大日志
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/back-end/assets/js/app.c4a64f45.js" defer></script><script src="/back-end/assets/js/2.733019b2.js" defer></script><script src="/back-end/assets/js/60.0a6cae4e.js" defer></script>
  </body>
</html>
