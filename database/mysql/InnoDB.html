<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>InnoDB | 思考学习仓库</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="思考学习仓库沉淀">
    
    <link rel="preload" href="/back-end/assets/css/0.styles.e1ce56f9.css" as="style"><link rel="preload" href="/back-end/assets/js/app.02f0d5f1.js" as="script"><link rel="preload" href="/back-end/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/back-end/assets/js/60.5e2d6eb4.js" as="script">
    <link rel="stylesheet" href="/back-end/assets/css/0.styles.e1ce56f9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/back-end/" class="home-link router-link-active"><!----> <span class="site-name">思考学习仓库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/back-end/" class="nav-link">
  思考学习仓库
</a></div><div class="nav-item"><a href="/back-end/back-end-basic/" class="nav-link">
  java基础
</a></div><div class="nav-item"><a href="/back-end/middleware/" class="nav-link">
  中间件
</a></div><div class="nav-item"><a href="/back-end/spring/" class="nav-link">
  Spring框架
</a></div><div class="nav-item"><a href="/back-end/microservices/" class="nav-link">
  微服务框架
</a></div><div class="nav-item"><a href="/back-end/database/" class="nav-link router-link-active">
  数据库篇章
</a></div> <a href="https://github.com/think-studio/back-end" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/back-end/" class="nav-link">
  思考学习仓库
</a></div><div class="nav-item"><a href="/back-end/back-end-basic/" class="nav-link">
  java基础
</a></div><div class="nav-item"><a href="/back-end/middleware/" class="nav-link">
  中间件
</a></div><div class="nav-item"><a href="/back-end/spring/" class="nav-link">
  Spring框架
</a></div><div class="nav-item"><a href="/back-end/microservices/" class="nav-link">
  微服务框架
</a></div><div class="nav-item"><a href="/back-end/database/" class="nav-link router-link-active">
  数据库篇章
</a></div> <a href="https://github.com/think-studio/back-end" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>mysql</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/back-end/database/mysql/mysql基础.html" class="sidebar-link">mysql基础</a></li><li><a href="/back-end/database/mysql/mysql锁.html" class="sidebar-link">mysql锁</a></li><li><a href="/back-end/database/mysql/msyql索引.html" class="sidebar-link">mysql索引</a></li><li><a href="/back-end/database/mysql/mvcc和read_view.html" class="sidebar-link">mvcc和read_view</a></li><li><a href="/back-end/database/mysql/buffer_pool.html" class="sidebar-link">buffer_pool</a></li><li><a href="/back-end/database/mysql/mysql三大日志.html" class="sidebar-link">mysql三大日志</a></li><li><a href="/back-end/database/mysql/mysql主从.html" class="sidebar-link">mysql主从</a></li><li><a href="/back-end/database/mysql/mysql执行一条sql过程.html" class="sidebar-link">mysql执行一条sql过程</a></li><li><a href="/back-end/database/oltp/oltp型数据库.html" class="sidebar-link">oltp型数据库</a></li><li><a href="/back-end/database/olap/olap分析型数据库.html" class="sidebar-link">olap分析型数据库</a></li><li><a href="/back-end/database/mpp/mpp型数据库.html" class="sidebar-link">mpp型数据库</a></li><li><a href="/back-end/database/mysql/InnoDB.html" aria-current="page" class="active sidebar-link">InnoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/back-end/database/mysql/InnoDB.html#表空间" class="sidebar-link">表空间</a></li><li class="sidebar-sub-header"><a href="/back-end/database/mysql/InnoDB.html#页" class="sidebar-link">页</a></li><li class="sidebar-sub-header"><a href="/back-end/database/mysql/InnoDB.html#buffer-pool缓冲池" class="sidebar-link">Buffer Pool缓冲池</a></li><li class="sidebar-sub-header"><a href="/back-end/database/mysql/InnoDB.html#参考链接" class="sidebar-link">参考链接</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="innodb"><a href="#innodb" class="header-anchor">#</a> InnoDB</h1> <h2 id="表空间"><a href="#表空间" class="header-anchor">#</a> 表空间</h2> <p>后面写</p> <h2 id="页"><a href="#页" class="header-anchor">#</a> 页</h2> <p>每个空间都被划分为许多个页，通常每个页的大小为 16KB（这个页大小可能因为两方面影响而有所变化：编译时修改了 UNIV_PAGE_SIZE 定义的值，或者使用了 InnoDB 压缩）。InnoDB 为空间中的每个页都分配了一个32位的整数页码，通常称为“偏移量”，这实际上只是这个页从空间开始位置 的偏移量（因为对于多个文件组成的空间来说，并不一定是从文件开始位置的偏移量）。因此，0 号页 位于偏移量为 0 的位置，1 号页位于偏移量为 16384 的位置，等等。（有的读者可能知道 InnoDB 有一个数据大小限制是64TB，这实际上是每个空间的大小限制，主要是由于页号是一个32位的整数，结合默认的页面大小16KB可以得到：232 x 16 KB = 64 TB）</p> <p>一个页的基本布局</p> <p><img src="http://d.jcole.us/blog/files/innodb/20130103/72dpi/Basic_Page_Overview.png" alt=""> <img src="http://d.jcole.us/blog/files/innodb/20130103/72dpi/FIL_Header_and_Trailer.png" alt=""></p> <ul><li>Page Type(2)：页面类型存储在 FIL Header 中。因为页被用于 文件空间管理、区段管理、事务系统、数据字典、回滚日志[undo log]、 二进制大对象[blobs]，还有索引（也就是表的数据）等多种用途，不同的用途的页面可能结构不同，所以为了解析页面数据，必须要有页面类型这个字段。</li> <li>Space ID(4)：当前页面所属空间的空间ID。</li> <li>Offset(Page Number)(4)：页码。当页被初始化后，页码就会存储在FIL Header中。通过比较 “从该字段读取的页码” 与 “基于文件偏移量的页码” 是否匹配，可以检验页面读取是否正确，并且这个字段被初始化同时就表明页面已经被初始化。</li> <li>Previous Page(4) &amp; Next Page(4)：相同类型页面的逻辑上一页和下一页的指针存储在FIL Header中。这两个指针是用来构建双向链表的，用于将同一层级的INDEX类型页面连接起来，这在进行范围扫描的时候是非常有效的，例如全索引扫描。但许多类型的页面其实都不使用这两个字段。</li> <li>LSN for last page modification(8) &amp; Low 32 bits of LSN(4)：页面最后一次修改的日志序列号（简写为LSN，64位整数）存储在FIL Header中，并且同一 LSN 的低32位存储在FIL Trailer中。</li></ul> <h3 id="索引页"><a href="#索引页" class="header-anchor">#</a> 索引页</h3> <p>索引页的结构</p> <p><img src="https://cdn.xiaolincoding.com//mysql/other/243b1466779a9e107ae3ef0155604a17.png" alt=""></p> <p>各个部分的作用</p> <p><img src="https://cdn.xiaolincoding.com//mysql/other/fabd6dadd61a0aa342d7107213955a72.png" alt=""></p> <p>在 File Header 中有两个指针，分别指向上一个数据页和下一个数据页，连接起来的页相当于一个双向的链表，如下图所示：</p> <p><img src="https://cdn.xiaolincoding.com//mysql/other/557d17e05ce90f18591c2305871af665.png" alt=""></p> <p>采用链表的结构是让数据页之间不需要是物理上的连续的，而是逻辑上的连续。</p> <p>数据页中的记录按照「主键」顺序组成单向链表，单向链表的特点就是插入、删除非常方便，但是检索效率不高，最差的情况下需要遍历链表上的所有节点才能完成检索。</p> <h2 id="buffer-pool缓冲池"><a href="#buffer-pool缓冲池" class="header-anchor">#</a> Buffer Pool缓冲池</h2> <p>InnoDB 存储引擎基于磁盘存储的，并将其中的记录按照页的方式进行管理，但是由于 CPU 速度和磁盘速度之间的鸿沟，基于磁盘的数据库系统通常使用缓冲池记录来提高数据库的整体性能。</p> <p>在数据库进行读取操作，将从磁盘中读到的 page （页）放在缓冲池中，下次再读取相同的页中时，首先判断该页是否在缓冲池中。若在缓冲池中，称该页在缓冲池中被命中，直接读取该页，否则读取磁盘上的页。</p> <p>对于数据库中页的修改操作，首先修改在缓冲池中的页，然后再以一定的频率刷新到磁盘上，页从缓冲池刷新回磁盘的操作并不是在每次页发生更新时触发，而是通过一种称为 CheckPoint 的机制刷新回磁盘。所以，缓冲池的大小直接影响着数据库的整体性能，<a href="https://dev.mysql.com/doc/refman/8.0/en/memory-use.html" target="_blank" rel="noopener noreferrer">MySQL 官方文档给出的建议是物理机器的 50%-75% 的占比<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>由于缓冲池不是无限大的，随着不停的把磁盘上的数据页加载到缓冲池中，缓冲池总要被用完，这个时候只能淘汰掉一些缓存页，淘汰方式就使用 LRU（最近最少被使用）算法，具体来说就是引入一个新的 LRU 链表，通过这个 LRU 链表，就可以知道哪些缓存页是最近最少被使用的，那么当你缓存页需要腾出来一个刷入磁盘的时候，可以选择那个 LRU 链表中最近最少被使用的缓存页淘汰。</p> <h2 id="参考链接"><a href="#参考链接" class="header-anchor">#</a> 参考链接</h2> <ul><li><a href="http://mysql.taobao.org/monthly/2018/04/03/" target="_blank" rel="noopener noreferrer">MySQL · 引擎特性 · InnoDB 数据页解析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://mysql.taobao.org/monthly/2017/11/01/" target="_blank" rel="noopener noreferrer">MySQL · 数据恢复 · undrop-for-innodb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://mysql.taobao.org/monthly/2017/05/01/" target="_blank" rel="noopener noreferrer">MySQL · 引擎特性 · InnoDB Buffer Pool<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.xiaolincoding.com/mysql/index/page.html#innodb-%E6%98%AF%E5%A6%82%E4%BD%95%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E7%9A%84" target="_blank" rel="noopener noreferrer">从数据页的角度看 B+ 树<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6985888702568333343" target="_blank" rel="noopener noreferrer">[翻译] InnoDB 空间文件布局基础<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/think-studio/back-end/edit/learn-warehouse/docs/database/mysql/InnoDB.md" target="_blank" rel="noopener noreferrer">欢迎来到思考学习仓库,一起沉淀知识</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/back-end/database/mpp/mpp型数据库.html" class="prev">
        mpp型数据库
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/back-end/assets/js/app.02f0d5f1.js" defer></script><script src="/back-end/assets/js/2.733019b2.js" defer></script><script src="/back-end/assets/js/60.5e2d6eb4.js" defer></script>
  </body>
</html>
